<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æˆ‘å°†ä¼šåœ¨2026å¹´7æœˆ28æ—¥å…¬å¼€æˆ‘çš„èº«ä»½</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --bg: url(https://bing.img.run/1920x1080.php);
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    background:#000;
    color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    background-image:var(--bg);
    background-size:cover;
    background-position:center;
    background-repeat:no-repeat;
    transition:background-image 1.5s ease-in-out;
    position: relative;
  }
  /* æ›´æµ…çš„é®ç½©ï¼Œç¡®ä¿èƒŒæ™¯å›¾ç‰‡å¯è§ */
  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.1);
    z-index: -1;
  }
  #top{
    position:absolute;
    top:1.2rem;
    text-align:center;
    text-shadow:0 0 10px rgba(0,0,0,.8);
    z-index: 1;
  }
  #top h1{font-size:1.6rem;margin-bottom:.3rem;}
  #top p{font-size:1.1rem;}
  #countdown{
    font-size:3.5rem;
    font-weight:700;
    text-shadow:0 0 15px rgba(0,0,0,.9);
    z-index: 1;
  }
  #countdown small{font-size:1.4rem;font-weight:400;}
  #audio-control {
    position: absolute;
    bottom: 1.2rem;
    right: 1.2rem;
    background: rgba(0, 0, 0, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    z-index: 1;
  }
  #audio-control:hover {
    background: rgba(0, 0, 0, 0.7);
  }
  @media(max-width:600px){
    #countdown{font-size:2.4rem;}
    #top h1{font-size:1.3rem;}
    #audio-control {
      bottom: 1rem;
      right: 1rem;
    }
  }
</style>
</head>
<body>
<div id="top">
  <h1 id="today"></h1>
  <p id="festival"></p>
</div>
<div id="countdown">
  <span id="d">--</span> å¤©
  <small id="hms">--:--:--</small>
</div>
<button id="audio-control">ğŸ”Š</button>

<audio id="bg-music" loop>
  <source src="djsjshwjgbwdsf.mp3" type="audio/mpeg">
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
</audio>

<script>
/* ====== åŒ—äº¬æ—¶é—´ ====== */
function beijingNow() {
  return new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Shanghai" }));
}
function pad(n) { return n < 10 ? '0' + n : n; }

/* ====== å€’è®¡æ—¶ ====== */
const target = new Date('2026-07-28T00:00:00+08:00');
function tick() {
  const now = beijingNow();
  const diff = target - now;
  if (diff <= 0) { 
    document.getElementById('countdown').innerHTML = '<span style="font-size: 2.5rem;">ğŸ‰ å·²åˆ°è¾¾ï¼</span>'; 
    return; 
  }
  const d = Math.floor(diff / 864e5);
  const h = Math.floor(diff / 36e5) % 24;
  const m = Math.floor(diff / 6e4) % 60;
  const s = Math.floor(diff / 1e3) % 60;
  document.getElementById('d').textContent = d;
  document.getElementById('hms').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
  document.title = `${d} å¤© | å€’è®¡æ—¶`;
}
tick(); 
setInterval(tick, 1000);

/* ====== æ—¥æœŸ & å†œå† ====== */
const week = 'æ—¥ä¸€äºŒä¸‰å››äº”å…­';
function loadFest() {
  const now = beijingNow();
  const y = now.getFullYear(), m = now.getMonth() + 1, d = now.getDate();
  document.getElementById('today').textContent = `${y}å¹´${m}æœˆ${d}æ—¥  æ˜ŸæœŸ${week[now.getDay()]}`;
  
  // æ˜¾ç¤ºå†œå†
  const lunarInfo = getLunar(y, m, d);
  document.getElementById('festival').textContent = `å†œå† ${lunarInfo.month}æœˆ${lunarInfo.day}`;
}

/* ====== èƒŒæ™¯å›¾åˆ‡æ¢ - ä½¿ç”¨å¿…åº”æ¯æ—¥å£çº¸ ====== */
function setBg() {
  // ä½¿ç”¨å¿…åº”æ¯æ—¥å£çº¸API
  const bingUrls = [
    'https://bing.img.run/1920x1080.php',
    'https://bing.img.run/uhd.php',
    'https://bing.img.run/1366x768.php'
  ];
  
  // éšæœºé€‰æ‹©ä¸€ä¸ªå¿…åº”å£çº¸URL
  const randomBingUrl = bingUrls[Math.floor(Math.random() * bingUrls.length)];
  
  // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
  const urlWithTimestamp = `${randomBingUrl}?t=${Date.now()}`;
  
  const img = new Image();
  img.onload = function() {
    document.documentElement.style.setProperty('--bg', `url(${urlWithTimestamp})`);
    console.log('å¿…åº”å£çº¸åŠ è½½æˆåŠŸ:', urlWithTimestamp);
  };
  img.onerror = function() {
    console.log('å¿…åº”å£çº¸åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨å›¾ç‰‡');
    // å¦‚æœå¿…åº”å£çº¸åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨å›¾ç‰‡
    const fallbackUrl = `https://picsum.photos/1920/1080?random=${Date.now()}`;
    document.documentElement.style.setProperty('--bg', `url(${fallbackUrl})`);
  };
  img.src = urlWithTimestamp;
}

/* ====== å†œå†è®¡ç®— - ä½¿ç”¨æ›´å‡†ç¡®çš„æ–¹æ³• ====== */
function getLunar(y, m, d) {
  // å†œå†æœˆä»½å’Œæ—¥æœŸåç§°
  const lunarMonths = ['æ­£', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å', 'å†¬', 'è…Š'];
  const lunarDays = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
    'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
    'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
  
  // å·²çŸ¥çš„å…¬å†-å†œå†å¯¹ç…§è¡¨ï¼ˆ2025å¹´éƒ¨åˆ†æ—¥æœŸï¼‰
  const lunarCalendar2025 = {
    '2025-01-01': { month: 'è…Š', day: 'åˆäºŒ' },
    '2025-01-29': { month: 'æ­£', day: 'åˆä¸€' }, // æ˜¥èŠ‚
    '2025-02-27': { month: 'æ­£', day: 'å»¿ä¹' },
    '2025-02-28': { month: 'äºŒ', day: 'åˆä¸€' },
    '2025-03-29': { month: 'äºŒ', day: 'ä¸‰å' },
    '2025-03-30': { month: 'ä¸‰', day: 'åˆä¸€' },
    '2025-04-28': { month: 'å››', day: 'åˆä¸€' },
    '2025-05-27': { month: 'äº”', day: 'åˆä¸€' },
    '2025-06-26': { month: 'å…­', day: 'åˆä¸€' },
    '2025-07-25': { month: 'ä¸ƒ', day: 'åˆä¸€' },
    '2025-08-23': { month: 'å…«', day: 'åˆä¸€' },
    '2025-09-22': { month: 'ä¹', day: 'åˆä¸€' },
    '2025-10-02': { month: 'ä¹', day: 'åä¸€' }, // ä»Šå¤©çš„å†œå†æ—¥æœŸ
    '2025-10-21': { month: 'å', day: 'åˆä¸€' },
    '2025-11-20': { month: 'å†¬', day: 'åˆä¸€' },
    '2025-12-19': { month: 'è…Š', day: 'åˆä¸€' }
  };
  
  // åˆ›å»ºæ—¥æœŸå­—ç¬¦ä¸²ç”¨äºæŸ¥æ‰¾
  const dateStr = `${y}-${pad(m)}-${pad(d)}`;
  
  // å¦‚æœåœ¨å¯¹ç…§è¡¨ä¸­æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›
  if (lunarCalendar2025[dateStr]) {
    return lunarCalendar2025[dateStr];
  }
  
  // å¦‚æœä¸åœ¨å¯¹ç…§è¡¨ä¸­ï¼Œä½¿ç”¨è¿‘ä¼¼è®¡ç®—
  // æŸ¥æ‰¾æœ€è¿‘çš„å·²çŸ¥å†œå†æ—¥æœŸ
  const knownDates = Object.keys(lunarCalendar2025);
  let closestDate = null;
  let minDiff = Infinity;
  
  for (const knownDate of knownDates) {
    const knownDateObj = new Date(knownDate);
    const currentDateObj = new Date(y, m-1, d);
    const diff = Math.abs(currentDateObj - knownDateObj);
    
    if (diff < minDiff) {
      minDiff = diff;
      closestDate = knownDate;
    }
  }
  
  if (closestDate) {
    const baseLunar = lunarCalendar2025[closestDate];
    const baseDate = new Date(closestDate);
    const currentDate = new Date(y, m-1, d);
    const dayDiff = Math.floor((currentDate - baseDate) / (1000 * 60 * 60 * 24));
    
    // è®¡ç®—å†œå†æ—¥æœŸ
    let lunarDayIndex = lunarDays.indexOf(baseLunar.day) + dayDiff;
    let lunarMonthIndex = lunarMonths.indexOf(baseLunar.month);
    
    // å¤„ç†æœˆä»½å’Œæ—¥æœŸçš„è¿›ä½
    while (lunarDayIndex >= lunarDays.length) {
      lunarDayIndex -= lunarDays.length;
      lunarMonthIndex = (lunarMonthIndex + 1) % 12;
    }
    
    while (lunarDayIndex < 0) {
      lunarDayIndex += lunarDays.length;
      lunarMonthIndex = (lunarMonthIndex - 1 + 12) % 12;
    }
    
    return {
      month: lunarMonths[lunarMonthIndex],
      day: lunarDays[lunarDayIndex]
    };
  }
  
  // å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•å·²çŸ¥æ—¥æœŸï¼Œä½¿ç”¨é»˜è®¤å€¼
  return {
    month: lunarMonths[(m + 1) % 12],
    day: lunarDays[d % 30]
  };
}

/* ====== éŸ³é¢‘æ’­æ”¾åŠŸèƒ½ ====== */
function initAudio() {
  const audio = document.getElementById('bg-music');
  const audioControl = document.getElementById('audio-control');
  
  // ä»æœ¬åœ°å­˜å‚¨è·å–ä¿å­˜çš„æ’­æ”¾è¿›åº¦
  const savedTime = localStorage.getItem('audioPlaybackTime');
  const savedVolume = localStorage.getItem('audioVolume');
  const savedMuted = localStorage.getItem('audioMuted');
  
  // è®¾ç½®éŸ³é‡
  if (savedVolume !== null) {
    audio.volume = parseFloat(savedVolume);
  } else {
    audio.volume = 0.5; // é»˜è®¤éŸ³é‡
  }
  
  // è®¾ç½®é™éŸ³çŠ¶æ€
  if (savedMuted !== null) {
    audio.muted = savedMuted === 'true';
    updateAudioControlIcon(audio.muted);
  }
  
  // å°è¯•è‡ªåŠ¨æ’­æ”¾
  const playAudio = () => {
    if (savedTime !== null) {
      audio.currentTime = parseFloat(savedTime);
    }
    
    audio.play().then(() => {
      console.log('éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
    }).catch(error => {
      console.log('éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', error);
      // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤º
      audioControl.textContent = 'â–¶ï¸';
      audioControl.title = 'ç‚¹å‡»æ’­æ”¾éŸ³é¢‘';
    });
  };
  
  // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  audioControl.addEventListener('click', () => {
    if (audio.paused) {
      audio.play();
      updateAudioControlIcon(audio.muted);
    } else {
      audio.pause();
      audioControl.textContent = 'â–¶ï¸';
    }
  });
  
  // æ·»åŠ éŸ³é‡æ§åˆ¶ï¼ˆé€šè¿‡æ»šè½®ï¼‰
  audioControl.addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? -0.1 : 0.1;
    audio.volume = Math.min(1, Math.max(0, audio.volume + delta));
    localStorage.setItem('audioVolume', audio.volume.toString());
    
    // çŸ­æš‚æ˜¾ç¤ºéŸ³é‡
    audioControl.title = `éŸ³é‡: ${Math.round(audio.volume * 100)}%`;
    setTimeout(() => {
      audioControl.title = audio.muted ? 'å–æ¶ˆé™éŸ³' : 'é™éŸ³';
    }, 2000);
  });
  
  // åŒå‡»åˆ‡æ¢é™éŸ³
  audioControl.addEventListener('dblclick', (e) => {
    e.preventDefault();
    audio.muted = !audio.muted;
    localStorage.setItem('audioMuted', audio.muted.toString());
    updateAudioControlIcon(audio.muted);
  });
  
  // å®šæœŸä¿å­˜æ’­æ”¾è¿›åº¦
  setInterval(() => {
    if (!audio.paused) {
      localStorage.setItem('audioPlaybackTime', audio.currentTime.toString());
    }
  }, 1000);
  
  // æ›´æ–°éŸ³é¢‘æ§åˆ¶å›¾æ ‡
  function updateAudioControlIcon(muted) {
    if (muted) {
      audioControl.textContent = 'ğŸ”‡';
      audioControl.title = 'å–æ¶ˆé™éŸ³';
    } else {
      audioControl.textContent = 'ğŸ”Š';
      audioControl.title = 'é™éŸ³';
    }
  }
  
  // é¡µé¢åŠ è½½åå°è¯•è‡ªåŠ¨æ’­æ”¾
  window.addEventListener('load', playAudio);
  
  // ç”¨æˆ·ä¸é¡µé¢äº¤äº’åå°è¯•æ’­æ”¾ï¼ˆè§£å†³æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
  document.addEventListener('click', () => {
    if (audio.paused) {
      playAudio();
    }
  }, { once: true });
}

// åˆå§‹åŒ–
loadFest();
setBg(); // ç«‹å³è®¾ç½®èƒŒæ™¯
initAudio(); // åˆå§‹åŒ–éŸ³é¢‘

// 30åˆ†é’Ÿè‡ªåŠ¨æ›´æ¢èƒŒæ™¯
setInterval(setBg, 30 * 60 * 1000);

// æ·»åŠ ä¸€ä¸ªå¤‡ç”¨èƒŒæ™¯åŠ è½½æœºåˆ¶ï¼Œé˜²æ­¢å›¾ç‰‡åŠ è½½å¤±è´¥
setTimeout(setBg, 5000);
</script>
</body>
</html>